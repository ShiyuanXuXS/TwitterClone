
@model TwitterClone.Models.Tweet

@{
    @* var isCurrentUserAuthor = Model.Author.UserName == User.Identity.Name; *@
    var isCurrentUserAuthor = Model.Author.UserName == "AAA222";
}

<div class="col-md-6 mb-4">
        <div class="card tweetCard border-0" >
            <div class="card-body p-4">
                <div class="d-flex align-items-center mb-2">
                @if (!string.IsNullOrEmpty(Model.Author.Avatar))
                {
                    <img src="@Model.Author.Avatar" alt="Author Avatar" class="rounded-circle" width="32" height="32">
                }
                else
                {
                    <i class="bi bi-person-fill fs-4 text-muted"></i> 
                }
                <div class="ms-2">
                    <h6 class="mb-0">@Model.Author.NickName</h6>
                    <p class="text-muted">@Model.Author.UserName</p>
                </div>
                <button type="button" class="followButton btn btn-light ms-auto" data-user-id="@Model.Author.Id">
                    <i id="followIcon-@Model.Author.Id" class="bi bi-person-plus-fill"></i> 
                </button>
            </div>
                <div id="readonlyEditor_@Model.Id"></div>
                
                <p class="card-text"><small class="text-muted">@Html.DisplayFor(modelItem => Model.CreatedAt)</small></p>
                <div class="btn-group" role="group" aria-label="">
                    <button type="button" class="btn btn-light mx-2 rounded">
                        <i class="bi bi-chat"></i> <!-- replay -->
                    </button>
                    <button type="button" class="btn btn-light mx-2 rounded">
                        <i class="bi bi-arrow-repeat"></i><!-- Repost -->
                    </button>
                    <!-- Like Button -->
                    <button id="likeButton-@Model.Id" type="button" class="likeButton btn btn-light mx-2 rounded" tweetId="@Model.Id">
                         <!--<i id="likeIcon-@Model.Id" class="bi bi-heart-fill" fill="red"></i> -->
                        <svg id="likeIcon-@Model.Id" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-heart-fill" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314"/>
                        </svg>
                    </button>
                    <script>
                        var likeButton = document.getElementById(`likeButton-@Model.Id`);
                        var likeIcon=document.getElementById(`likeIcon-@Model.Id`);
                        //set color of like icon 
                        fetch(`/api/Like/getLikeStatus?tweetId=@Model.Id`)
                        .then(response=>response.json())
                        .then(data => {
                            var likeIcon=document.getElementById(`likeIcon-@Model.Id`);
                            if (data.liked) {
                                console.log("red");
                                likeIcon.setAttribute('fill', 'red');
                            }else{
                                likeIcon.setAttribute('fill', 'gray');
                                console.log("gray");
                            }
                        })
                        .catch(error => {
                            console.error( error);
                        });
                        //add click event handler on like button
                        likeButton.addEventListener('click',()=>{
                            fetch('/api/Like/setLike?tweetId=@Model.Id',{
                                method:'post'
                            })
                            .then(response=>response.json())
                            .then(data=>{
                                var likeIcon=document.getElementById(`likeIcon-@Model.Id`);
                                if (data.liked) {
                                    likeIcon.setAttribute('fill', 'red');
                                }else{
                                    likeIcon.setAttribute('fill', 'gray');
                                }
                            })
                        })

                    </script>
                                
                    @if (isCurrentUserAuthor)
                    {
                        <a href="/ShowTweet/AddEditTweet?id=@Model.Id" class="btn btn-light mx-2 rounded">
                            <i class="bi bi-pencil"></i> <!--Edit-->
                        </a>
                        <a href="/ShowTweet/DeleteTweet?id=@Model.Id" class="btn btn-danger mx-2 rounded">
                            <i class="bi bi-trash"></i> <!--Delete-->
                        </a>
                    }
                </div>
                
            </div>
        </div>
        
        <script>
            ClassicEditor
                .create(document.querySelector('#readonlyEditor_@Model.Id'), {
                    isReadOnly: true,
                    toolbar: []
                })
                .then(editor => {
                    editor.setData(`@Html.Raw(Model.Body)`);
                    editor.enableReadOnlyMode( '#readonlyEditor_@Model.Id');
                })
                .catch(error => {
                    console.error(error);
                });
        </script>
</div>


